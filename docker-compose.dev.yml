services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - "8080:8080"   # HTTP API + Frontend
      - "8081:8081"   # Gateway WebSocket
    volumes:
      # Mount source code for hot reloading
      - ./stark-backend:/app/stark-backend
      - ./stark-frontend:/app/stark-frontend
      - ./Cargo.toml:/app/Cargo.toml
      - ./Cargo.lock:/app/Cargo.lock
      # Use named volume for target dir to avoid rebuilding deps every time
      - cargo-target:/app/target
      # Cache cargo registry for faster rebuilds
      - cargo-registry:/usr/local/cargo/registry
    env_file:
      - .env
    environment:
      - RUST_LOG=debug
      - RUST_BACKTRACE=1

volumes:
  cargo-target:
  cargo-registry:
